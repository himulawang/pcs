!function () {
    var DataPool = function DataPool() {
        this.pool = {};
        this.toDelPool = {};
    };

    DataPool.prototype.set = function set(name, index, model) {
        this.pool[name + '-' + index] = model;
    };

    DataPool.prototype.get = function get(name, index) {
        return this.pool[name + '-' + index];
    };

    DataPool.prototype.unset = function unset(name, index) {
        delete this.pool[name + '-' + index];
    };

    DataPool.prototype.sync = function sync() {
        // add & update
        for (var i in this.pool) {
            var data = this.pool[i];

            var storeName = data.constructor.name + 'Store';

            if (data.getPK) {
                console.log('Update', storeName + ' ' + data.getPK());
            }
            I.Models[storeName].sync(data);
        }
        // del
        for (var j in this.toDelPool) {
            var toDelData = this.toDelPool[j];
            var storeName = toDelData.constructor.name + 'Store';
            if (data.getPK) {
                console.log('Delete', storeName + ' ' + toDelData.getPK());
            }
            I.Models[storeName].sync(toDelData);
            delete this.toDelPool[j];
        }
    };

    DataPool.prototype.del = function del(name, index) {
        var data = this.get(name, index);
        data.markDelSync();
        this.toDelPool[name + '-' + index] = data;
        this.unset(name, index);
    };

    I.Util.require('DataPool', '', DataPool);
}();
